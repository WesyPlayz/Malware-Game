using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class InteractionZone : MonoBehaviour
{
    // Object State Variables:
    public GameObject Entity;

    private Obj_State obj_Data;

    // Initiate State:
    void Start()
    {
        obj_Data = GetComponent<Obj_State>();
    }

    // Detection System:
    void Update()
    {
        obj_Data.collided_Entity = null;
        obj_Data.collided_Surface = Vector2.zero;

        // User Systems:
        if (Entity.name == "User")
        {
            // finds entities:
            Collider2D[] entities = Physics2D.OverlapCircleAll(transform.position, obj_Data.Reach / 2);

            GameObject closest_Entity = null;
            float closest_Distance = Mathf.Infinity;

            foreach (Collider2D entity in entities)
            {
                GameObject entity_Obj = entity.gameObject;
                if (entity_Obj.layer == LayerMask.NameToLayer("Entity"))
                {
                    float distance = Vector2.Distance(Entity.transform.position, entity_Obj.transform.position);
                    if (distance < closest_Distance)
                    {
                        closest_Entity = entity_Obj;
                        closest_Distance = distance;
                    }
                }
                else if (entity_Obj.layer == LayerMask.NameToLayer("Items"))
                {
                    // for items to be picked up.
                }
                else if (entity_Obj.layer == LayerMask.NameToLayer("Radio"))
                {
                    /* if (Input.GetButtonDown("Interact"))
                    {
                        if (obj_Data.currentChannel == RH.radioSounds.Length)
                            obj_Data.currentChannel = 0;
                        else
                            obj_Data.currentChannel++;

                        RH.playRadio();
                    } */
                }
            }
            obj_Data.collided_Entity = closest_Entity;
        }
        else if (Entity.name == "Enemy_Drone")
        {
            Collider2D[] objs = Physics2D.OverlapCircleAll(transform.position, obj_Data.Reach / 2);

            Vector2 closest_Point = Vector2.zero;
            float closest_Distance = Mathf.Infinity;

            foreach (Collider2D obj in objs)
            {
                GameObject surface_Obj = obj.gameObject;
                if (surface_Obj.layer == LayerMask.NameToLayer("User"))
                {
                    obj_Data.collided_Entity = surface_Obj;
                }
                else if (surface_Obj.layer == LayerMask.NameToLayer("Terrain"))
                {
                    Vector2 closest_Point_On_Surface = obj.ClosestPoint(Entity.transform.position);
                    float distance = Vector2.Distance(Entity.transform.position, closest_Point_On_Surface);
                    if (distance < closest_Distance)
                    {
                        closest_Point = closest_Point_On_Surface;
                        closest_Distance = distance;
                    }
                }
            }
            obj_Data.collided_Surface = closest_Point;
        }
    }
}