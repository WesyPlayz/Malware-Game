using System.Collections;
using System.Collections.Generic;
using UnityEngine;

using static Utilities.Generic;

public class EnemyHandler : MonoBehaviour
{
    // Object State Variables:
    public GameObject damaged_Particle;
    public AudioSource damaged_Sound;
    public AudioSource death_Sound;

    private Obj_State obj_Data;
    private Rigidbody2D obj_Physics;

    public bool can_Move = true;
    public bool is_Moving;
    public int move;

    // Initiate State:
    void Start()
    {
        obj_Data = GetComponent<Obj_State>();
        obj_Physics = GetComponent<Rigidbody2D>();
    }

    // Health System
    void Update()
    {
        if (obj_Data.Health == 0)
            Destroy(gameObject);

        if (!can_Move && is_Moving)
        {
            if (move == 0)
                obj_Physics.AddForce(Vector2.right * obj_Data.Speed);
            else if (move > 0)
                obj_Physics.AddForce(Vector2.left * obj_Data.Speed);
        }
        if (can_Move && !is_Moving)
        {
            move = 1 - move;
            is_Moving = true;
            StartCoroutine(Move());
        }
    }
    void OnCollisionEnter2D(Collision2D sender)
    {
        if (sender.gameObject.layer == LayerMask.NameToLayer("Projectile"))
        {
            Obj_State projectile_Data = sender.gameObject.GetComponent<Obj_State>();
            damaged_Particle.GetComponent<ParticleSystem>().Play();
            damaged_Sound.Play();
            obj_Data.Health = Mathf.Max(obj_Data.Health - projectile_Data.Damage, 0);
            Destroy(sender.gameObject);
        }
    }

    IEnumerator Move()
    {
        obj_Physics.AddForce(Vector2.right * 0);
        yield return new WaitForSeconds(1);
        can_Move = false;
        yield return new WaitForSeconds(10000000000);
        is_Moving = false;
        can_Move = true;
    }

    void OnDestroy()
    {
        death_Sound.Play();
    }
}